# Markmap Enhanced 用户指南

欢迎使用 Markmap Enhanced！这是一个增强版的交互式思维导图工具，可以将 Markdown 文档可视化为美观的思维导图。

## 目录

- [快速开始](#快速开始)
- [核心功能](#核心功能)
- [备注功能](#备注功能)
- [搜索功能](#搜索功能)
- [展开与折叠](#展开与折叠)
- [导出功能](#导出功能)
- [颜色主题](#颜色主题)
- [画布交互](#画布交互)
- [移动端使用](#移动端使用)
- [快捷键列表](#快捷键列表)
- [常见问题](#常见问题)

---

## 快速开始

### 基本使用

1. **输入 Markdown 内容**：使用标准的 Markdown 列表语法创建思维导图结构
2. **查看思维导图**：内容会自动转换为交互式思维导图
3. **探索和交互**：使用鼠标或触摸手势浏览、缩放和编辑

### Markdown 语法示例

```markdown
# 主题
## 子主题 1
- 要点 1
- 要点 2
## 子主题 2
- 要点 3
```

---

## 核心功能

### 1. Markdown 解析

Markmap Enhanced 支持标准的 Markdown 语法：

- **标题**：使用 `#` 创建不同层级的节点
- **列表**：使用 `-` 或 `*` 创建列表项
- **代码块**：支持语法高亮
- **数学公式**：支持 KaTeX 数学公式
- **复选框**：支持 `- [ ]` 和 `- [x]` 语法

### 2. 自动布局

思维导图会自动调整布局以适应内容：

- **初始化时**：自动居中并设置合适的缩放比例
- **内容变化时**：自动重新计算节点位置
- **窗口调整时**：自动适应新的视口尺寸
- **展开/折叠时**：平滑过渡到新布局

### 3. 响应式设计

- 自动适应不同屏幕尺寸
- 移动端优化的触摸交互
- 工具栏自动调整布局

---

## 备注功能

Markmap Enhanced 支持两种类型的备注，让您可以为节点添加额外的说明信息。

### 单行备注

使用冒号（`:`）分隔主内容和备注：

```markdown
- 节点标题: 这是一个简短的备注说明
```

**显示效果**：
- 节点显示"节点标题"
- 节点右侧显示备注图标 📝
- 点击图标可查看完整备注

### 详细备注

使用引用块（`>`）创建多行详细备注：

```markdown
- 节点标题
  > 这是详细备注的第一行
  > 可以包含多行内容
  > 支持 **Markdown** 格式
```

**显示效果**：
- 节点显示"节点标题"
- 节点右侧显示备注图标 📝
- 点击图标可查看格式化的详细备注

### 混合使用

可以同时使用单行备注和详细备注：

```markdown
- 节点标题: 简短说明
  > 详细的补充信息
  > 可以包含更多细节
```

### 查看和编辑备注

1. **查看备注**：点击节点右侧的备注图标 📝
2. **编辑备注**：在弹出的备注面板中直接编辑
3. **保存更改**：更改会自动保存
4. **关闭面板**：再次点击图标或点击关闭按钮

### 特殊字符处理

如果内容中包含冒号，使用反斜杠转义：

```markdown
- 时间\: 14:30: 这是备注
```

显示为："时间: 14:30"，备注为"这是备注"

---

## 搜索功能

快速定位思维导图中的任何内容。

### 使用搜索

1. **打开搜索框**：点击工具栏左侧的搜索图标，或使用快捷键 `Ctrl+F` (Windows) / `Cmd+F` (Mac)
2. **输入关键词**：在搜索框中输入要查找的内容
3. **查看结果**：匹配的节点会自动高亮显示

### 搜索范围

搜索会在以下内容中查找：
- 节点主内容
- 单行备注
- 详细备注

### 搜索导航

- **下一个结果**：点击 ↓ 按钮或按 `Enter`
- **上一个结果**：点击 ↑ 按钮或按 `Shift+Enter`
- **清除搜索**：清空搜索框或按 `Esc`

### 自动展开

搜索时，包含匹配结果的折叠节点会自动展开，确保所有结果都可见。

---

## 展开与折叠

控制思维导图的显示层级，专注于重要内容。

### 节点级操作

**单个节点**：
- 点击节点可切换其展开/折叠状态
- 展开：显示该节点的所有子节点
- 折叠：隐藏该节点的所有子节点

**节点及其子树**：
1. 右键点击节点
2. 选择"展开全部"或"折叠全部"
3. 该节点及其所有后代节点会相应展开或折叠

### 全局操作

**工具栏按钮**：
- **展开全部**：点击 ⊕ 按钮，展开所有节点
- **折叠全部**：点击 ⊖ 按钮，折叠除第一层外的所有节点

**快捷键**：
- `Ctrl+Shift+E` (Windows) / `Cmd+Shift+E` (Mac)：展开全部
- `Ctrl+Shift+C` (Windows) / `Cmd+Shift+C` (Mac)：折叠全部

### 布局调整

展开或折叠节点后，思维导图会自动调整布局，使用平滑动画过渡到新状态。

---

## 导出功能

将思维导图导出为多种格式，方便分享和使用。

### 导出为 Markdown

**节点级导出**：
1. 右键点击任意节点
2. 选择"复制为 Markdown"
3. 该节点及其所有子节点会以 Markdown 格式复制到剪贴板

**特点**：
- 保持原有层级结构
- 保留备注格式（冒号分隔和引用块）
- 保留所有 Markdown 格式

### 导出为图片

**支持的格式**：
- **PNG**：适合网页和文档
- **JPG**：适合打印和分享
- **SVG**：矢量格式，可无限缩放

**导出步骤**：
1. 点击工具栏的导出按钮 📥
2. 选择所需格式
3. 浏览器会自动下载文件

**导出范围**：
- 导出当前可见的思维导图内容
- 建议在导出前调整视图以包含所需内容

---

## 颜色主题

自定义思维导图的视觉风格。

### 预设主题

Markmap Enhanced 提供多种预设颜色方案：

- **Default**：经典配色，适合大多数场景
- **Ocean**：海洋风格，清新淡雅
- **Forest**：森林风格，自然舒适
- **Sunset**：日落风格，温暖明亮
- **Monochrome**：单色风格，简洁专业

### 切换主题

1. 点击工具栏的颜色选择器图标 🎨
2. 从下拉菜单中选择主题
3. 颜色会平滑过渡到新主题

### 主题持久化

选择的颜色主题会自动保存到本地存储，下次打开时会自动应用。

### 颜色应用规则

- 节点颜色按层级循环使用
- 连接线颜色与父节点保持一致
- 保持良好的对比度和可读性

---

## 画布交互

类似 Excalidraw 的流畅画布体验。

### 平移画布

**鼠标操作**：
- 按住 `Space` 键 + 拖动鼠标
- 或直接拖动画布空白区域

**触摸操作**：
- 单指拖动

### 缩放画布

**鼠标操作**：
- 滚动鼠标滚轮
- 向上滚动：放大
- 向下滚动：缩小

**触摸操作**：
- 双指捏合手势
- 张开：放大
- 收拢：缩小

### 节点交互

**点击节点**：
- 切换展开/折叠状态

**右键节点**：
- 显示上下文菜单
- 选项：复制为 Markdown、展开全部、折叠全部

**点击备注图标**：
- 显示/隐藏备注面板

### 画布菜单

**右键空白区域**：
- 显示画布级别菜单
- 选项：导出为 PNG、JPG、SVG

### 响应速度

所有交互操作都在 300 毫秒内响应，确保流畅的用户体验。

---

## 移动端使用

Markmap Enhanced 完全支持移动设备，提供优化的触摸体验。

### 触摸手势

**单指拖动**：
- 平移画布视图

**双指捏合**：
- 缩放画布内容
- 张开手指：放大
- 收拢手指：缩小

**单击节点**：
- 切换展开/折叠状态

**长按节点**：
- 显示上下文菜单

### 屏幕方向

- 自动适应横屏和竖屏
- 方向改变时自动重新布局
- 保持当前视图状态

### 工具栏适配

- 小屏幕设备上自动调整布局
- 必要时使用折叠菜单
- 保持所有功能可访问

### 备注面板适配

- 自动调整面板大小和位置
- 适应屏幕尺寸
- 支持滚动查看长内容

---

## 快捷键列表

### 通用快捷键

| 功能 | Windows/Linux | Mac |
|------|---------------|-----|
| 搜索 | `Ctrl+F` | `Cmd+F` |
| 清除搜索 | `Esc` | `Esc` |
| 下一个搜索结果 | `Enter` | `Enter` |
| 上一个搜索结果 | `Shift+Enter` | `Shift+Enter` |

### 编辑快捷键

| 功能 | Windows/Linux | Mac |
|------|---------------|-----|
| 撤销 | `Ctrl+Z` | `Cmd+Z` |
| 重做 | `Ctrl+Y` 或 `Ctrl+Shift+Z` | `Cmd+Shift+Z` |

### 视图快捷键

| 功能 | Windows/Linux | Mac |
|------|---------------|-----|
| 展开全部 | `Ctrl+Shift+E` | `Cmd+Shift+E` |
| 折叠全部 | `Ctrl+Shift+C` | `Cmd+Shift+C` |

### 画布快捷键

| 功能 | 操作 |
|------|------|
| 平移画布 | `Space` + 拖动鼠标 |
| 缩放画布 | 鼠标滚轮 |
| 展开/折叠节点 | 点击节点 |

### 鼠标操作

| 功能 | 操作 |
|------|------|
| 节点菜单 | 右键点击节点 |
| 画布菜单 | 右键点击空白区域 |
| 查看备注 | 点击备注图标 📝 |

---

## 常见问题

### 1. 如何添加备注？

**单行备注**：在节点内容后添加冒号和备注文本
```markdown
- 节点: 备注内容
```

**详细备注**：在节点下方使用引用块
```markdown
- 节点
  > 详细备注
  > 可以多行
```

### 2. 备注图标不显示？

检查以下几点：
- 确保使用了正确的分隔符（默认为 `:`）
- 确保备注内容不为空
- 刷新页面重新加载

### 3. 搜索找不到内容？

- 检查关键词拼写
- 搜索是模糊匹配，尝试使用部分关键词
- 确保内容确实存在于节点或备注中

### 4. 如何保存我的思维导图？

- **自动保存**：编辑内容会自动保存到浏览器本地存储
- **手动导出**：使用导出功能保存为 Markdown 或图片
- **复制内容**：右键节点选择"复制为 Markdown"

### 5. 导出的图片不完整？

- 在导出前调整视图，确保所有需要的内容都可见
- 使用"展开全部"功能显示所有节点
- 调整缩放比例以适应画布

### 6. 移动端无法缩放？

- 确保使用双指捏合手势
- 检查浏览器是否支持触摸事件
- 尝试刷新页面

### 7. 如何自定义分隔符？

如果您是开发者，可以在初始化时配置：

```typescript
const transformer = new Transformer({
  separators: {
    note: '::',        // 自定义备注分隔符
    noteBlock: '>>',   // 自定义备注块标记
    escape: '\\'       // 自定义转义字符
  }
});
```

### 8. 撤销功能不工作？

- 确保使用正确的快捷键
- 撤销功能仅支持备注编辑操作
- 检查是否有可撤销的操作

### 9. 颜色主题无法保存？

- 检查浏览器是否启用了本地存储
- 清除浏览器缓存后重试
- 确保不在隐私/无痕模式下使用

### 10. 性能问题（节点过多）？

- 使用折叠功能隐藏不需要的节点
- 考虑将大型思维导图拆分为多个小图
- 导出为图片以提高查看性能

---

## 技术支持

### 获取帮助

- **文档**：查看 [API 文档](./api/README.md)
- **示例**：参考项目中的示例文件
- **问题反馈**：在 GitHub 上提交 Issue

### 相关资源

- [需求文档](../.kiro/specs/markmap-enhanced/requirements.md)
- [设计文档](../.kiro/specs/markmap-enhanced/design.md)
- [API 文档](./api/README.md)
- [Markmap 官方文档](https://markmap.js.org/)

---

## 更新日志

### v1.0.0 (当前版本)

**新增功能**：
- ✅ 备注功能（单行和详细备注）
- ✅ 搜索功能（模糊匹配、高亮、导航）
- ✅ 展开/折叠控制（节点级和全局）
- ✅ 自动动态布局
- ✅ 导出功能（Markdown、PNG、JPG、SVG）
- ✅ 颜色主题选择
- ✅ 移动端支持
- ✅ 撤销/重做功能
- ✅ Excalidraw 风格工具栏
- ✅ 数据持久化

**改进**：
- 优化渲染性能
- 改进触摸手势识别
- 增强响应式布局
- 完善错误处理

---

## 许可证

本项目基于 MIT 许可证开源。详见 [LICENSE](./LICENSE) 文件。

---

**享受使用 Markmap Enhanced！** 🎉

如有任何问题或建议，欢迎反馈。
