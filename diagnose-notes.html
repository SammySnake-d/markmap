<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>å¤‡æ³¨åŠŸèƒ½è¯Šæ–­</title>
  <style>
    body {
      margin: 20px;
      font-family: monospace;
      background: #1e1e1e;
      color: #d4d4d4;
    }
    
    h1 {
      color: #4ec9b0;
    }
    
    .test-section {
      background: #252526;
      border: 1px solid #3e3e42;
      border-radius: 8px;
      padding: 15px;
      margin-bottom: 20px;
    }
    
    .test-section h2 {
      margin-top: 0;
      color: #569cd6;
    }
    
    .pass {
      color: #4ec9b0;
    }
    
    .fail {
      color: #f48771;
    }
    
    .info {
      color: #dcdcaa;
    }
    
    pre {
      background: #1e1e1e;
      border: 1px solid #3e3e42;
      padding: 10px;
      border-radius: 4px;
      overflow-x: auto;
    }
    
    button {
      background: #0e639c;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 4px;
      cursor: pointer;
      font-size: 14px;
      margin-right: 10px;
    }
    
    button:hover {
      background: #1177bb;
    }
    
    #mindmap {
      width: 100%;
      height: 300px;
      background: white;
      border-radius: 8px;
      margin-top: 10px;
    }
  </style>
</head>
<body>
  <h1>ğŸ” å¤‡æ³¨åŠŸèƒ½è¯Šæ–­å·¥å…·</h1>
  
  <div class="test-section">
    <h2>1. åº“åŠ è½½æ£€æŸ¥</h2>
    <div id="library-check">æ£€æŸ¥ä¸­...</div>
  </div>
  
  <div class="test-section">
    <h2>2. Markmap å®ä¾‹æ£€æŸ¥</h2>
    <button onclick="createInstance()">åˆ›å»º Markmap å®ä¾‹</button>
    <div id="instance-check" style="margin-top: 10px;">ç­‰å¾…åˆ›å»ºå®ä¾‹...</div>
    <svg id="mindmap"></svg>
  </div>
  
  <div class="test-section">
    <h2>3. æ–¹æ³•å­˜åœ¨æ€§æ£€æŸ¥</h2>
    <div id="method-check">ç­‰å¾…åˆ›å»ºå®ä¾‹...</div>
  </div>
  
  <div class="test-section">
    <h2>4. æ‰‹åŠ¨æµ‹è¯•å¤‡æ³¨åŠŸèƒ½</h2>
    <button onclick="testNoteFunction()">æµ‹è¯• handleNoteIconClick</button>
    <div id="function-test" style="margin-top: 10px;">ç­‰å¾…æµ‹è¯•...</div>
  </div>
  
  <div class="test-section">
    <h2>5. æ„å»ºä¿¡æ¯</h2>
    <div id="build-info">
      <p class="info">è¯·æ£€æŸ¥ä»¥ä¸‹æ–‡ä»¶çš„ä¿®æ”¹æ—¶é—´ï¼š</p>
      <pre>markmap/packages/markmap-view/dist/browser/index.js</pre>
      <p class="info">å¦‚æœæ—¶é—´ä¸æ˜¯æœ€æ–°çš„ï¼Œè¯·è¿è¡Œï¼š</p>
      <pre>cd markmap/packages/markmap-view && pnpm build:js</pre>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/d3@7/dist/d3.min.js"></script>
  <script src="./packages/markmap-lib/dist/browser/index.iife.js"></script>
  <script src="./packages/markmap-view/dist/browser/index.js"></script>
  
  <script>
    let view;
    let rootData;
    
    // 1. æ£€æŸ¥åº“åŠ è½½
    window.addEventListener('load', () => {
      const checkDiv = document.getElementById('library-check');
      let html = '';
      
      // æ£€æŸ¥ D3
      if (typeof d3 !== 'undefined') {
        html += '<p class="pass">âœ… D3.js å·²åŠ è½½ (ç‰ˆæœ¬: ' + d3.version + ')</p>';
      } else {
        html += '<p class="fail">âŒ D3.js æœªåŠ è½½</p>';
      }
      
      // æ£€æŸ¥ markmap
      if (typeof window.markmap !== 'undefined') {
        html += '<p class="pass">âœ… Markmap åº“å·²åŠ è½½</p>';
        
        if (window.markmap.Transformer) {
          html += '<p class="pass">  âœ… Transformer å¯ç”¨</p>';
        } else {
          html += '<p class="fail">  âŒ Transformer ä¸å¯ç”¨</p>';
        }
        
        if (window.markmap.Markmap) {
          html += '<p class="pass">  âœ… Markmap ç±»å¯ç”¨</p>';
        } else {
          html += '<p class="fail">  âŒ Markmap ç±»ä¸å¯ç”¨</p>';
        }
      } else {
        html += '<p class="fail">âŒ Markmap åº“æœªåŠ è½½</p>';
      }
      
      checkDiv.innerHTML = html;
    });
    
    // 2. åˆ›å»ºå®ä¾‹
    function createInstance() {
      const checkDiv = document.getElementById('instance-check');
      
      try {
        checkDiv.innerHTML = '<p class="info">â³ åˆ›å»º Markmap å®ä¾‹...</p>';
        
        const { Transformer, Markmap } = window.markmap;
        const transformer = new Transformer();
        const { root } = transformer.transform(`
# æµ‹è¯•èŠ‚ç‚¹
## å­èŠ‚ç‚¹ 1
- é¡¹ç›® A
- é¡¹ç›® B
## å­èŠ‚ç‚¹ 2
- ä»»åŠ¡ X
- ä»»åŠ¡ Y
        `);
        
        rootData = root;
        
        const svg = document.querySelector('#mindmap');
        view = Markmap.create(svg, {
          duration: 500,
          maxWidth: 300,
          initialExpandLevel: 3
        });
        
        view.setData(root);
        view.fit();
        
        checkDiv.innerHTML = '<p class="pass">âœ… Markmap å®ä¾‹åˆ›å»ºæˆåŠŸ</p>';
        
        // æ£€æŸ¥æ–¹æ³•
        checkMethods();
        
      } catch (error) {
        checkDiv.innerHTML = '<p class="fail">âŒ åˆ›å»ºå¤±è´¥: ' + error.message + '</p>';
        console.error(error);
      }
    }
    
    // 3. æ£€æŸ¥æ–¹æ³•
    function checkMethods() {
      const checkDiv = document.getElementById('method-check');
      
      if (!view) {
        checkDiv.innerHTML = '<p class="fail">âŒ è¯·å…ˆåˆ›å»º Markmap å®ä¾‹</p>';
        return;
      }
      
      let html = '';
      
      // æ£€æŸ¥å…³é”®æ–¹æ³•
      const methods = [
        'handleNoteIconClick',
        'setData',
        'fit',
        'exportAsMarkdown'
      ];
      
      methods.forEach(method => {
        if (typeof view[method] === 'function') {
          html += `<p class="pass">âœ… ${method} æ–¹æ³•å­˜åœ¨</p>`;
        } else {
          html += `<p class="fail">âŒ ${method} æ–¹æ³•ä¸å­˜åœ¨</p>`;
        }
      });
      
      // æ£€æŸ¥ notePanel
      if (view.notePanel) {
        html += '<p class="pass">âœ… notePanel å¯¹è±¡å­˜åœ¨</p>';
        
        if (typeof view.notePanel.show === 'function') {
          html += '<p class="pass">  âœ… notePanel.show æ–¹æ³•å­˜åœ¨</p>';
        } else {
          html += '<p class="fail">  âŒ notePanel.show æ–¹æ³•ä¸å­˜åœ¨</p>';
        }
      } else {
        html += '<p class="fail">âŒ notePanel å¯¹è±¡ä¸å­˜åœ¨</p>';
      }
      
      // åˆ—å‡ºæ‰€æœ‰æ–¹æ³•
      html += '<p class="info">ğŸ“‹ æ‰€æœ‰å¯ç”¨æ–¹æ³•ï¼š</p>';
      html += '<pre>';
      const allMethods = [];
      for (let key in view) {
        if (typeof view[key] === 'function') {
          allMethods.push(key);
        }
      }
      html += allMethods.sort().join('\n');
      html += '</pre>';
      
      checkDiv.innerHTML = html;
    }
    
    // 4. æµ‹è¯•åŠŸèƒ½
    function testNoteFunction() {
      const testDiv = document.getElementById('function-test');
      
      if (!view || !rootData) {
        testDiv.innerHTML = '<p class="fail">âŒ è¯·å…ˆåˆ›å»º Markmap å®ä¾‹</p>';
        return;
      }
      
      try {
        testDiv.innerHTML = '<p class="info">â³ æµ‹è¯• handleNoteIconClick...</p>';
        
        // æ‰¾åˆ°ç¬¬ä¸€ä¸ªèŠ‚ç‚¹
        const firstNode = rootData.children ? rootData.children[0] : rootData;
        
        // è°ƒç”¨æ–¹æ³•
        view.handleNoteIconClick(firstNode, 100, 100);
        
        testDiv.innerHTML = '<p class="pass">âœ… handleNoteIconClick è°ƒç”¨æˆåŠŸï¼</p>' +
                           '<p class="info">åº”è¯¥çœ‹åˆ°å¤‡æ³¨é¢æ¿å‡ºç°åœ¨é¡µé¢ä¸Š</p>';
        
      } catch (error) {
        testDiv.innerHTML = '<p class="fail">âŒ æµ‹è¯•å¤±è´¥: ' + error.message + '</p>' +
                           '<pre>' + error.stack + '</pre>';
        console.error(error);
      }
    }
  </script>
</body>
</html>
