<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Blockquote è§£æè°ƒè¯•</title>
  <style>
    body {
      margin: 20px;
      font-family: monospace;
      background: #1e1e1e;
      color: #d4d4d4;
    }
    
    h1 {
      color: #4ec9b0;
    }
    
    .section {
      background: #252526;
      border: 1px solid #3e3e42;
      border-radius: 8px;
      padding: 15px;
      margin-bottom: 20px;
    }
    
    .section h2 {
      margin-top: 0;
      color: #569cd6;
    }
    
    pre {
      background: #1e1e1e;
      border: 1px solid #3e3e42;
      padding: 10px;
      border-radius: 4px;
      overflow-x: auto;
      white-space: pre-wrap;
      max-height: 400px;
      overflow-y: auto;
    }
    
    .pass {
      color: #4ec9b0;
    }
    
    .fail {
      color: #f48771;
    }
    
    .info {
      color: #dcdcaa;
    }
    
    button {
      background: #0e639c;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 4px;
      cursor: pointer;
      font-size: 14px;
      margin-right: 10px;
    }
    
    button:hover {
      background: #1177bb;
    }
  </style>
</head>
<body>
  <h1>ğŸ” Blockquote è§£æè°ƒè¯•</h1>
  
  <div class="section">
    <h2>æµ‹è¯• Markdown</h2>
    <pre id="markdown-input">- ç”¨æˆ·è°ƒç ”: ç¬¬ä¸€é˜¶æ®µå®Œæˆ
  > **è°ƒç ”å¯¹è±¡**: ä¼ä¸šç”¨æˆ· 50 äºº
  > **è°ƒç ”æ–¹å¼**: é—®å· + æ·±åº¦è®¿è°ˆ
  > **å…³é”®å‘ç°**:
  > - éœ€è¦å¤‡æ³¨åŠŸèƒ½
  > - éœ€è¦æœç´¢åŠŸèƒ½</pre>
  </div>
  
  <div class="section">
    <h2>æ­¥éª¤ 1: markdown-it è§£æç»“æœ</h2>
    <button onclick="step1()">è¿è¡Œæ­¥éª¤ 1</button>
    <pre id="step1-result">ç­‰å¾…è¿è¡Œ...</pre>
  </div>
  
  <div class="section">
    <h2>æ­¥éª¤ 2: Transformer è§£æç»“æœ</h2>
    <button onclick="step2()">è¿è¡Œæ­¥éª¤ 2</button>
    <pre id="step2-result">ç­‰å¾…è¿è¡Œ...</pre>
  </div>
  
  <div class="section">
    <h2>æ­¥éª¤ 3: èŠ‚ç‚¹æ•°æ®æ£€æŸ¥</h2>
    <button onclick="step3()">è¿è¡Œæ­¥éª¤ 3</button>
    <pre id="step3-result">ç­‰å¾…è¿è¡Œ...</pre>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/d3@7/dist/d3.min.js"></script>
  <script src="./packages/markmap-lib/dist/browser/index.iife.js"></script>
  
  <script>
    let transformResult;
    
    function escapeHtml(text) {
      const div = document.createElement('div');
      div.textContent = text;
      return div.innerHTML;
    }
    
    function step1() {
      const markdown = document.getElementById('markdown-input').textContent;
      const resultDiv = document.getElementById('step1-result');
      
      try {
        // ä½¿ç”¨ markdown-it ç›´æ¥è§£æ
        const md = window.markdownit();
        const html = md.render(markdown);
        
        let output = 'åŸå§‹ Markdown:\n';
        output += markdown + '\n\n';
        output += 'markdown-it ç”Ÿæˆçš„ HTML:\n';
        output += html + '\n\n';
        output += 'HTML (è½¬ä¹‰æ˜¾ç¤º):\n';
        output += escapeHtml(html);
        
        resultDiv.textContent = output;
        
      } catch (error) {
        resultDiv.textContent = 'é”™è¯¯: ' + error.message + '\n' + error.stack;
      }
    }
    
    function step2() {
      const markdown = document.getElementById('markdown-input').textContent;
      const resultDiv = document.getElementById('step2-result');
      
      try {
        const { Transformer } = window.markmap;
        const transformer = new Transformer();
        
        // å®Œæ•´çš„ markdown
        const fullMarkdown = `# æµ‹è¯•\n\n${markdown}`;
        
        transformResult = transformer.transform(fullMarkdown);
        
        let output = 'å®Œæ•´ Markdown:\n';
        output += fullMarkdown + '\n\n';
        output += 'Transformer è§£æç»“æœ:\n';
        output += JSON.stringify(transformResult.root, null, 2);
        
        resultDiv.textContent = output;
        
      } catch (error) {
        resultDiv.textContent = 'é”™è¯¯: ' + error.message + '\n' + error.stack;
      }
    }
    
    function step3() {
      const resultDiv = document.getElementById('step3-result');
      
      if (!transformResult) {
        resultDiv.textContent = 'è¯·å…ˆè¿è¡Œæ­¥éª¤ 2';
        return;
      }
      
      try {
        let output = 'èŠ‚ç‚¹æ•°æ®æ£€æŸ¥:\n\n';
        
        function checkNode(node, indent = '') {
          output += indent + 'èŠ‚ç‚¹: ' + node.content + '\n';
          output += indent + '  - hasNote: ' + (node.hasNote || false) + '\n';
          output += indent + '  - inlineNote: ' + (node.inlineNote || 'undefined') + '\n';
          output += indent + '  - detailedNote: ' + (node.detailedNote || 'undefined') + '\n';
          
          if (node.children && node.children.length > 0) {
            output += indent + '  - children: ' + node.children.length + '\n';
            node.children.forEach(child => {
              checkNode(child, indent + '    ');
            });
          }
        }
        
        checkNode(transformResult.root);
        
        resultDiv.textContent = output;
        
      } catch (error) {
        resultDiv.textContent = 'é”™è¯¯: ' + error.message + '\n' + error.stack;
      }
    }
    
    // è‡ªåŠ¨è¿è¡Œ
    window.addEventListener('load', function() {
      if (typeof window.markmap === 'undefined') {
        document.getElementById('step1-result').textContent = 'âŒ Markmap åº“åŠ è½½å¤±è´¥';
        return;
      }
      
      // æ£€æŸ¥ markdown-it æ˜¯å¦å¯ç”¨
      if (typeof window.markdownit === 'undefined') {
        // åŠ¨æ€åŠ è½½ markdown-it
        const script = document.createElement('script');
        script.src = 'https://cdn.jsdelivr.net/npm/markdown-it@13/dist/markdown-it.min.js';
        script.onload = () => {
          console.log('markdown-it åŠ è½½æˆåŠŸ');
        };
        document.head.appendChild(script);
      }
    });
  </script>
</body>
</html>
